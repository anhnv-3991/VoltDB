# Voltify - VoltDB Database Porting Tool


## Introduction

VoltDB Voltify provides a quick start for users with existing non-VoltDB
databases. The most important sections to read in order to get started
are Prerequisites and Basic Usage.

Voltify ports foreign schemas to VoltDB and creates simple working
starter projects. Starter projects run out of the box on a single host,
and can grow to include user-provided stored procedures and client
applications.

Please note this Voltify pre-release is experimental. It only supports
MySQL schema import. Other products will be supported in the future.

As an experimental component Voltify has not been exhaustively tested.
Please thoroughly check all generated code before using it in an
application.

This documentation provides an overview of the tool and some basic
usage. It does not completely document all settings and options. It
should provide enough information to get started.


## Prerequisites

Similar to "voltadmin", Voltify requires Python 2.6 or 2.7.

The mysql-python module needs the MySQL client library, the mysql_config
command, and the Python headers (for compiled C code).  The necessary
packages can installed using the system package manager, e.g. on
Ubuntu/Debian the following command should pull in these requirements.

    sudo apt-get install mysql-client libmysqlclient-dev python-dev

Existing MySQL development environments are likely to already have some
or all of these packages installed.

All other Python library requirements are automatically installed by
voltify into the virtual environment during the first run. No user
action is required.


## How Voltify Works

Voltify is a Python shell script based on the same modular command
framework as voltadmin. It runs in a virtual environment with all
library dependencies resolved locally. It does not affect system-wide
Python libraries. It does not require root access.

The first run builds a virtual environment and downloads and installs
library dependencies. Internet access is required for the "pip" package
manager to be able to download the needed installation packages.

Voltify runs as a database client to connect to a server and scan system
tables in order to acquire a schema. It cannot parse DDL source code.

Voltify automatically saves and uses a volt.cfg properties file that
provides all configuration options.

### Partitioning

Since VoltDB is a distributed database its schema needs to know how to
partition tables, i.e. which tables get partitioned and which column to
use as the partitioning key.

Voltify attempts to deduce partitioning by analyzing source schema
foreign key relationships. It starts with a single "partitioning table"
as the focal point and follows foreign key relationships to other
tables. It guesses that strongly-related tables have data that will
partition based on their related keys.

Either an explicit partitioning table may be specified in the
configuration (with the "partition_table" property) or Voltify will use
the table with the largest row count as a guess. If your database is
empty or doesn't have representative data you will want to explicitly
specify a partitioning table for best results.


## Generated Files

Voltify generates the following project files.

### ddl.sql

This file is a heavily annotated VoltDB schema definition. The
annotations point out important choices made during code generation,
including data type conversions. It is well worth trying to understand
these choices.  The conversion is not one to one.

### deployment.xml

This file supplies an initial minimal VoltDB deployment configuration
for 1 host and 2 sites.

### run.sh

This file is a Bash script that makes it more convenient to build the
VoltDB catalog and run the server.

Please note that if you change the number of hosts in the deployment
file and or wish to use a server other than localhost you may want to
update run.sh. It is hard-coded for localhost.

### voltify-README.txt

This file has some basic information related to the code generated by
Voltify.

### volt.cfg

This file is automatically saved and loaded by Voltify to manage
configuration properties.

It uses the INI file format. Configuration properties use "name = value"
syntax under a [voltify] section header. Spacing is not significant and
quotes are not needed.

The volt.cfg file can be managed with the "voltify config" sub-command.
It can also be hand-edited.


## Getting Help

Voltify has a full command line help system accessible through the
"help" sub-command or the -h option.

### Getting Basic Help

    voltify help

### Getting Sub-Command Help

    voltify help (subcommand)

For example, to get help with the porting tool:

    voltify help port


## Basic Usage

The basic sequence is as follows.

1. Make sure the source database is running.
1. Generate an initial configuration.
1. Update the configuration to provide a connection string and possibly
   a partitioning table.
1. Port the source database (and generate project files).
1. Examine or edit the generated files, particularly ddl.sql.

### Sample Session

    $ mkdir myproject

    $ cd myproject

    $ sudo mysql.server start     (if it's not running)
    Starting MySQL
     SUCCESS!

    $ voltify port

    The following settings must be configured before proceeding:

       PROPERTY           DESCRIPTION
       -----------------  --------------------------
       connection_string  database connection string

    The following setting defaults were applied and saved permanently:

       PROPERTY         VALUE
       ---------------  --------------
       ddl_file         ddl.sql
       deployment_file  deployment.xml
       host_count       1
       kfactor          0
       package          voltapp
       partition_table  AUTO
       run_script       run.sh
       sites_per_host   2
       source_type      mysql

    Use the "config" verb to modify and view properties as follows.

    To set a property (using actual property name):
       voltify config set connection_string=CONNECTION_STRING_VALUE

    To display one, many, or all properties:
       voltify config get name
       voltify config get name1 name2 ...
       voltify config get

    To get "config" command help:
       voltify help config

    You can also edit "volt.cfg" directly in a text editor.

    $ voltify config set connection_string=mysql://root:password@localhost/employees
    set voltify.connection_string=mysql://root:password@localhost/employees

    $ voltify config set partition_table=Customer
    set voltify.partition_table=Customer

    $ voltify config get
    voltify.connection_string=mysql://root:password@localhost/employees
    voltify.ddl_file=ddl.sql
    voltify.deployment_file=deployment.xml
    voltify.host_count=1
    voltify.kfactor=0
    voltify.package=voltapp
    voltify.partition_table=Customer
    voltify.run_script=run.sh
    voltify.sites_per_host=2
    voltify.source_type=mysql

    $ voltify port
    INFO: Generating "voltify-README.txt"...
    INFO: Generating "deployment.xml"...
    INFO: Generating "run.sh"...
    INFO: Generating "ddl.sql"...
    INFO: Generating "src/com/voltapp/Client.java"...
    INFO: Project files were generated successfully.
    INFO: Please examine the following files thoroughly before using.
    INFO:   voltify-README.txt
    INFO:   deployment.xml
    INFO:   run.sh
    INFO:   ddl.sql
    INFO:   src/com/voltapp/Client.java
